<!DOCTYPE html>
<html>
   <head>
      <title>Cards</title>
      <link rel="stylesheet" type="text/css" href="CardGame.css">
   </head>
   <body class = "head" onload="getCards()">
<div id="field">

 <div id="cardTemp" class="card" style="left: 0px; width: 315px; height: 440px; top: 0px;"></div>      



</div>
  <div id="execute" class = "execute">
     <h1>
     Execution:
     </h1>
     <input type="submit" value="Submit" onclick="submitGlobalVariable()">
    <div id="output">
    </div>

     </div>
     <div id="allCards"></div>
  
   </body>
   <script>
url = "https://sgp5y79yog.execute-api.us-west-2.amazonaws.com/refinery/programminglanguage"
cardStack = []


document.getElementById("allCards").style.width="1000";

console.log("Total Width: " + screen.width);
console.log("Total Height: " + screen.height);
cardHeight = 220;
cardWidth = 157.5;

async function getCards(){
  data = await fetchPost('',"https://sgp5y79yog.execute-api.us-west-2.amazonaws.com/refinery/card");
  //console.log(data);
  topPosition = 600;

  for (i = 0, inc=0; i < data.length; i++, inc++){
    console.log(inc)
    var wrapper= document.createElement('div');
    wrapper.innerHTML= trim(data[i]);
    var div= wrapper.firstChild;
    document.getElementById("allCards").appendChild(div);
    leftPosition = (cardWidth+10)*inc;
    if (leftPosition>1000){
      leftPosition = "0px";
      inc = -1;
      topPosition=topPosition+cardHeight+10;
    }
    div.style.left = leftPosition+"px";
    div.style.width = cardWidth+"px";
    div.style.height = cardHeight+"px";
    div.style.top = topPosition+"px";
  }

  //document.getElementById('card').innerHTML = data)
}



function submitVariable(){
  var value = document.getElementsByClassName('cardValue');
  var i = cards.length
  for(x=0; x<i; x++){
      console.log(cards[x].value);
  }

}


function submitGlobalVariable(){
  var cards = document.getElementById('field').getElementsByClassName('cardValue');
  var i = cards.length
  var data = ""
  for(x=0; x<i; x++){
      if (cards[x].value == undefined){
        data = data + trim(cards[x].innerHTML) + " ";
      }
      else{
        data = data + trim(cards[x].value) + " ";
      }
  }
  console.log(data);
  fetchPost([data], url)
    .then(data => document.getElementById('output').innerHTML = data);
}

function trim(s){ 
  return ( s || '' ).replace( /^\s+|\s+$/g, '' ); 
}


function fetchPost(data, url) {
  return fetch(url, {  
    method: "POST",  
    cors: true,
    body: JSON.stringify(
      data
    )
  }).then(response => response.json());   
}



function getInt(text){
  var matches = text.match(/(\d+)/);
  if (matches){
    return (parseInt(matches[0], 10));
  }
}

function addNewCard(cardID, len){
  console.log(cardID +' Clicked');
  div = document.getElementById(cardID);
  //console.log(div);
  newDiv = div.cloneNode(true);
  newDiv.setAttribute("id", "card"+len);

  newDiv.style.left = (330*len)+"px";
  newDiv.style.width = "315px";
  newDiv.style.height = "440px";
  newDiv.style.top = "0px";

  document.getElementById('field').appendChild(newDiv);
}




isDown = false;
firstPass = true;


document.addEventListener('mousedown', function(e) {
  var cardsInPlay = document.getElementById("field").getElementsByClassName('card');
  len = cardsInPlay.length;
  var cards = document.getElementById("allCards").getElementsByClassName('card');
  isDown = true;
  console.log(cardsInPlay);
  for (i=0;i<cards.length;i++){
    card=cards[i];
    left = getInt(card.style.left);
    right = left + getInt(card.style.width);
    cTop = getInt(card.style.top);
    bot = cTop + getInt(card.style.height);

    if((e.clientX >= left && e.clientX<right)&&(e.clientY >= cTop && e.clientY<bot)){
      cardID = cards[i].id;
      if (firstPass){
        firstPass=false;
        var elem = document.getElementById('cardTemp');
        elem.parentNode.removeChild(elem);
        len--;
      }
      addNewCard(cardID, len);
    }
  }
  //console.log(e.clientX, e.clientY);
}, true);

document.addEventListener('mouseup', function() {
    isDown = false;
}, true);

document.addEventListener('mousemove', function(event) {
        
    event.preventDefault();
    if (isDown) {
        mousePosition = {
    
            x : event.clientX,
            y : event.clientY
        };
        //console.log(mousePosition)
    }
    
}, true);
   </script>
</html>
